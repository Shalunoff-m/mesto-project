(()=>{"use strict";var e="269e9438-b227-400f-84a0-3e13cb6c82c5",t="plus-cohort-16",n="users/me",o="cards",r="likes",a={baseUrl:"".concat("https://nomoreparties.co","/v1/").concat(t,"/"),headers:{authorization:e,"Content-Type":"application/json"}},i=o,c=n,u=function(e){return fetch("".concat(a.baseUrl).concat(e),{headers:a.headers}).then(y)},l=function(e){return fetch("".concat(a.baseUrl).concat(n),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e.name,about:e.job})}).then(y)},s=function(e){return fetch("".concat(a.baseUrl).concat(o),{method:"POST",headers:a.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(y)},p=function(e){return fetch("".concat(a.baseUrl).concat(o,"/").concat(e),{method:"DELETE",headers:a.headers}).then(y)},m=function(e){return fetch("".concat(a.baseUrl).concat(o,"/").concat(r,"/").concat(e),{method:"PUT",headers:a.headers}).then(y)},f=function(e){return fetch("".concat(a.baseUrl).concat(o,"/").concat(r,"/").concat(e),{method:"DELETE",headers:a.headers}).then(y)},d=function(e){return fetch("".concat(a.baseUrl).concat(n,"/").concat("avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e.link})}).then(y)};function y(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function v(e){var t=document;e.base!==document&&(t=document.querySelector("".concat(e.base)));var n={},o={};for(var r in e.elements){if("base"===e.elements[r].type&&(n[r]=document.querySelector("".concat(e.elements[r].key))),"simple"===e.elements[r].type&&(n[r]=t.querySelector("".concat(e.elements[r].key))),"formMain"===e.elements[r].type){var a=e.elements[r].key;o=document.forms["".concat(a)],n[r]=o}if("formElement"===e.elements[r].type){var i=e.elements[r].key;n[r]=o.elements["".concat(i)]}}return n}function b(e,t){var n={};for(var o in t.elements)"formElement"===t.elements[o].type&&(n[o]=t.elements[o].key);for(var r in n)n[r]=e[r].value;return n}function h(e){return e.textContent}function _(e,t){t.textContent=e}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var g={};function E(e,t){var n;g=e,e.classList.add("popup_opened"),document.addEventListener("keydown",S),t.reset&&((n=t.modal).form.reset(),n.savebutton.setAttribute("disabled",!0))}function S(e){A(g,e)}function A(e,t){(function(e){return!!e.target.classList.contains("popup__close")||(!!e.target.classList.contains("popup")||("submit"===e.type||"Escape"===e.key))})(t)&&(document.removeEventListener("keydown",S),e.classList.remove("popup_opened"))}function w(e,t,n){"start"===n.to&&t.container.prepend(e),"end"===n.to&&t.container.append(e)}function L(e,t,n,o){var r=t.template.content.cloneNode(!0),a=r.querySelector(".elements__item"),i=r.querySelector(".elements__caption"),c=r.querySelector(".elements__image"),u=r.querySelector(".elements__like-button"),l=r.querySelector(".elements__like-counter"),s=r.querySelector(".elements__delete-button");return i.textContent=e.name,c.setAttribute("src",e.link),c.setAttribute("alt",e.name),a.id=e._id,l.textContent=e.likes.length,u.addEventListener("click",(function(e){u.classList.contains("elements__like-button_active")?U(a,u,{act:"dislike"}):U(a,u,{act:"like"})})),s.addEventListener("click",(function(e){var t;p((t=a).id).then((function(){t.remove()})).catch((function(e){console.log(e)}))})),c.addEventListener("click",(function(){o(e.name,e.link)})),function(e,t){var n=e.likes.some((function(e){return e._id===t}));return n}(e,n)&&j(u),function(e,t){return e.owner._id===t}(e,n)||s.remove(),r}function C(e,t){t.querySelector(".elements__like-counter").textContent=e.likes.length}function j(e){e.classList.toggle("elements__like-button_active")}function U(e,t,n){"dislike"===n.act?f(e.id).then((function(n){C(n,e),j(t)})).catch((function(e){console.log(e)})):m(e.id).then((function(n){C(n,e),j(t)})).catch((function(e){console.log(e)}))}function q(e,t){t.labelUserName.textContent=e.name,t.labelUserJob.textContent=e.about,t.photo.setAttribute("src",e.avatar)}function x(e,t,n){e.addEventListener("click",(function(){return t(n)}))}var M={base:document,elements:{photo:{key:".profile__photo",type:"simple"},labelUserName:{key:".profile__name",type:"simple"},labelUserJob:{key:".profile__job",type:"simple"},uiEditButton:{key:".profile__edit-button",type:"simple"},uiAddCardButton:{key:".profile__add-button",type:"simple"},uiEditAvatarButton:{key:".profile__avatar",type:"simple"}}},T={base:"#popup-avatar",elements:{modal:{key:"#popup-avatar",type:"base"},form:{key:"popup-avatar",type:"formMain"},link:{key:"link",type:"formElement"},savebutton:{key:".popup__submit",type:"simple"},closeButton:{key:".popup__close",type:"simple"}}},B={base:"#popup-edit-job",elements:{modal:{key:"#popup-edit-job",type:"base"},form:{key:"popupEditForm",type:"formMain"},name:{key:"name",type:"formElement"},job:{key:"job",type:"formElement"},savebutton:{key:".popup__submit",type:"simple"},closeButton:{key:".popup__close",type:"simple"}}},I={base:"#popup-new-place",elements:{modal:{key:"#popup-new-place",type:"base"},form:{key:"popupNewPlace",type:"formMain"},name:{key:"name",type:"formElement"},link:{key:"link",type:"formElement"},savebutton:{key:".popup__submit",type:"simple"},closeButton:{key:".popup__close",type:"simple"}}},N={base:document,elements:{container:{key:".elements__list",type:"simple"},template:{key:"#card",type:"simple"}}};function P(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var D,J,F=v(M),H=v({base:"#view-image",elements:{modal:{key:"#view-image",type:"base"},image:{key:".popup__image",type:"simple"},description:{key:".popup__imageName",type:"simple"},closeButton:{key:".popup__close",type:"simple"}}}),V=v(B),$=v(I),z=v(T),G=v(N),K="";function Q(e,t){!function(e,t,n){n.description.textContent=e,n.image.setAttribute("src",t),n.image.setAttribute("alt",e)}(e,t,H),E(H.modal,{modal:H,reset:!1})}D=function(e){switch(e.target.id){case"popupNewPlace":!function(e){console.log(e);var t=h(e.popup.savebutton);_("Сохранение...",e.popup.savebutton),s(b(e.popup,e.settings)).then((function(t){w(L(t,e.cardData,e.id,e.cb),e.cardData,{to:"start"}),A(e.popup.modal,e.evt)})).catch((function(e){console.log(e)})).finally((function(){_(t,e.popup.savebutton)}))}({evt:e,popup:$,settings:I,cardData:G,id:K,cb:Q});break;case"popupEditForm":!function(e){var t=h(e.popup.savebutton);_("Сохранение...",e.popup.savebutton);var n=b(e.popup,e.settings);l(n).then((function(t){q(t,e.ui),A(e.popup.modal,e.evt)})).catch((function(e){console.log(e)})).finally((function(){_(t,e.popup.savebutton)}))}({evt:e,popup:V,settings:B,ui:F});break;case"popup-avatar":!function(e){console.log(e.evt);var t=h(e.popup.savebutton);_("Сохранение...",e.popup.savebutton);var n=b(e.popup,e.settings);d(n).then((function(t){q(t,e.ui),A(e.popup.modal,e.evt)})).catch((function(e){console.log(e)})).finally((function(){_(t,e.popup.savebutton)})),console.log("Смена Авы")}({evt:e,popup:z,settings:T,ui:F})}},(J=document.forms,function(e){if(Array.isArray(e))return k(e)}(J)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(J)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(J)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault(),D(e)}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(e){e.stopPropagation(),A(e.target.closest(".popup"),e)}))})),Promise.all([u(c),u(i)]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return a}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],o=t[1];K=n._id,q(n,F),function(e,t,n){var o,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=P(e))){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}(e);try{for(r.s();!(o=r.n()).done;)w(L(o.value,t,n,Q),t,{to:"end"})}catch(e){r.e(e)}finally{r.f()}}(o,G,K)})).catch((function(e){console.log(e)})).finally((function(){})),x(F.uiEditButton,(function(){(function(e,t){t.name.value=e.labelUserName.textContent,t.job.value=e.labelUserJob.textContent})(F,V),E(V.modal,{modal:V,reset:!1})}),V),x(F.uiAddCardButton,(function(e){E(e.modal,{modal:e,reset:!0})}),$),x(F.uiEditAvatarButton,(function(){(function(e,t){t.link.value=e.photo.getAttribute("src")})(F,z),E(z.modal,{modal:z,reset:!1})}),z),function(e){function t(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}document.querySelectorAll("".concat(e.form)).forEach((function(n){var o,r,a,i=n.closest("".concat(e.popup)).querySelector("".concat(e.savebutton));o=n,r=i,t(a=Array.from(o.querySelectorAll("".concat(e.input))),r),o.addEventListener("reset",(function(){setTimeout((function(){t(a,r)}),0)})),a.forEach((function(n){n.addEventListener("input",(function(){!function(t,n){var o=n.validationMessage;o=n.validity.valueMissing?"Вы пропустили это поле":n.validationMessage,n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputError),o.classList.remove(e.labelError),o.textContent=e.validInput}(t,n):function(t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputError),r.classList.add(e.labelError),r.textContent=o}(t,n,o)}(o,n),t(a,r)}))}))}))}({inputError:"basic-data-input__input_type_error",labelError:"basic-data-input__input-error_active",validInput:"Верно",savebutton:".popup__submit",input:".basic-data-input__input",form:".popup__form",popup:".popup"})})();